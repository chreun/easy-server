<html lang="en" class="">
<head>
	<meta charset="UTF-8">
	<title>è½»æ¾ç­¹</title>
	<meta property="wb:webmaster" content="26f01d0b94394447">
	<meta property="qc:admins" content="2541756431167376730756375">
	<meta name="viewport"
				content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="format-detection" content="telephone=no">
	<link rel="shortcut icon" href="//static2.qschou.com/img/v7/common/favicon.ico">
	<link rel="â€apple-touch-iconâ€" href="//static2.qschou.com/img/v7/logo144.png">
	<link rel="stylesheet" href="/css/common.css">
	<link rel="stylesheet" href="/css/pay.main.css">
	<style type="text/css">.fancybox-margin {
		margin-right: 0;
	}</style>
	<style
			type="text/css">.ls-pop-sel .ls-verify-notice-green, .ls-main-content .ls-voice button, .ls-main-login .ls-agreement a, .ls-pop-verify p span, .ls-pop-sel .ls-verify-notice-green, .ls-agreement-detail .ft, .ls-main-content .ls-countdown {
		color: #61a951;
	}
	.ls-btn-normal {
		background: #61a951;
	}
	.ls-pop-verify input {
		caret-color: #61a951;
	}</style>
</head>
<body>

<div id="app">
	<div class="paycontainer publish-box_v1">
		<div class="paycontent">
			<div id="publish-box" class="publish-box">
				<div class="m-projinfo"><img class="u-avatar lazy-load"
											 v-bind:src="detail.portrait"
											 style="display: block;">
					<div class="u-info">
						<div class="u-name"><span class="u-nickname" v-cloak>{{detail.username}}</span> <span class="u-tips">é¡¹ç›®å‘èµ·äºº</span></div>
						<div class="u-msg">è°¢è°¢ä½ çš„çˆ±å¿ƒï¼Œå¤§æ©å¤§å¾·ï¼Œæ°¸ä¸èƒ½å¿˜ï¼ğŸ™</div>
					</div>
				</div>
			</div>
			<div class="paymain">
				<div class="h5ui-group first-group">
					<div class="h5ui-help-money">
						<div class="money-title-anonymous"><label for="money-input" class="h5ui-form-label">å¸®åŠ©é‡‘é¢</label>
							<div class="anonymous-box"><input type="checkbox" name="switch" id="anonymous" value="1"
															  class="switch switch-anonymous"> <span>åŒ¿å</span></div>
						</div>
					</div>
					<div id="js_input_border" class="h5ui-help-money h5ui-help-money_v1  money-input-content-bg ">
						<div class="money-input-content"><input type="tel" id="money-input" value="" class="h5ui-form-input"
																pattern="[0-9]*" maxlength="6" placeholder="è¯·è¾“å…¥å¸®åŠ©é‡‘é¢"
																v-model="money"
																onkeyup="this.value=(this.value.replace(/\D/g,'')==''|| (this.value =value.replace(/\D/g,''))==0?'':value)">
							<span class="random-change dtstrackclick" data-dta="moneyRandom_v1" id="moneyRandom_v1">å…ƒ</span></div>
					</div>
					<div class="h5ui-help-progress h5ui-help-progress_v1">
						<div class="progress_box">
							<div class="progress_bg"></div>
							<div class="product_progress">
								<div class="progress_green" style="width: 0%;"></div>
								<span class="progress_num" style="left: 0%;">0%</span></div>
						</div>
						<label class="progress_box_des">æ‚¨çš„æçŒ®é¢è¶…è¶Š <span class="progress_des_green">0%</span> çš„ç”¨æˆ·</label></div>
				</div>              <!-- çˆ±å¿ƒåŠµstart -->
				<section id="voucherBox"></section>             <!-- çˆ±å¿ƒåŠµend -->
				<!-- <div class="recommand-title">å¤§ç—…äº’åŠ©æƒç›Š</div> -->
				<div class="h5ui-group">
					<div class="h5ui-checkbox">
						<div class="recommand-title" style="margin-left: -15px;">å¤§ç—…äº’åŠ©æƒç›Š</div>
						<div class="h5ui-switch-group " data-ind="0" id="insurance">
							<div class="h5ui-radio_bd"><p class="huzhu_need_renew-disc">é™æ—¶<span>3å…ƒåŠ å…¥</span>ï¼Œæœ€é«˜å¯è·å¾—30ä¸‡å¤§ç—…äº’åŠ©é‡‘ï¼Œæ‚£å¤§ç—…ä¸æ„æ²¡é’±</p>
							</div>
							<div class="check-wrap"><input type="checkbox"  data-ind="0" name="insurance" v-on:click="checkItem()" v-model="state"
														   class="switch activity-checkbox dtstrackclick" data-dta="union_charge">
								<div class="check-text">æˆ‘å·²é˜…è¯»å¹¶åŒæ„ <a class="check-link yaoqiu" href="javascript:;">ã€Šå¥åº·è¦æ±‚ã€‹</a><a
										class="check-link gongyue" href="javascript:;">ã€Šè¡ŒåŠ¨å…¬çº¦ã€‹</a><a class="check-link hz-introduce"
																									href="javascript:;">ã€Šäº§å“è¯´æ˜ã€‹</a></div>
							</div>
						</div>
						<!-- yaoqingsong -->                                                             </div>
				</div>
				<div class="h5ui-group h5ui-pay-way"><h5 class="h5ui-uploader_title"> é€‰æ‹©æ”¯ä»˜æ–¹å¼ </h5>
					<div class="pay-way-main pay-way-main_v1"><p id="bank-wxpay" class="active wechatPay"><i
							class="icon-wechat"></i> å¾®ä¿¡</p>
						<p id="bank-alipay" class="aliPay"><i class="icon-alipay"></i> æ”¯ä»˜å®</p></div>
				</div>
			</div>
		</div>
	</div>
	<footer class="h5ui-bar h5ui-bar_v1 bar-fixed support_bar_total" id="pay-submit">
		<div class="h5ui-bar-left"><p class="h5ui-bar-title">åˆè®¡ : <span class="text-danger"  v-cloak>{{total_value}}</span> å…ƒ</p></div>
		<div class="h5ui-bar-right">
			<button class="h5ui-btn h5ui-btn_default btn-small-green dtstrackclick" v-on:click="callPay">ç¡®è®¤æ”¯ä»˜</button>
		</div>
	</footer>  <!-- äºŒç»´ç æ”¯ä»˜å¼¹çª— start -->
</div>

<script src="https://cdn.bootcss.com/vue/2.6.9/vue.min.js"></script>
<script src="https://cdn.bootcss.com/axios/0.19.0/axios.min.js"></script>
<script>
	const app = new Vue({
		el: '#app',
		data: {
			detail: {},
			project_id: 0,
			money: '',
			state: false
		},
		methods : {
			async getBaseData () {
				this.project_id = this.getRequest('id')
				let res = await axios.get('api/project/info?id=' + this.project_id);
				this.$nextTick(function () {
					this.detail = res.data.data
				})
			},

      async getPayParam() {
        let res = await axios.get('api/wechat/pay?id=' + this.project_id + '&total_fee=' +  this.total_value());
				return res.data.data
      },
			getRequest(key) {
				const url = location.href;
				const theRequest = new Object();
				const idx = url.indexOf("?")
				if (idx !== -1)
				{
					var str = url.substr(idx + 1);
					strs = str.split("&");
					for (var i = 0; i < strs.length; i++)
					{
						theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
					}
				}
				return theRequest[key];
			},
			checkItem () {
				this.state = !this.state
			},
			jsApiCall() {
				const param = this.getPayParam()
				WeixinJSBridge.invoke(
						'getBrandWCPayRequest',
						{'appId': param.appId,
							'nonceStr':param.nonceStr,
							'package':param.package,
							'signType':param.signType,
							'timeStamp':param.timeStamp,
							'paySign':param.paySign
						},
						function (res) {
							WeixinJSBridge.log(res.err_msg);
							alert(res.err_code + res.err_desc + res.err_msg);
						}
				);
			},
		 callPay() {
			 if (typeof WeixinJSBridge == "undefined") {
				 if (document.addEventListener) {
					 document.addEventListener('WeixinJSBridgeReady', jsApiCall, false);
				 } else if (document.attachEvent) {
					 document.attachEvent('WeixinJSBridgeReady', jsApiCall);
					 document.attachEvent('onWeixinJSBridgeReady', jsApiCall);
				 }
			 } else {
				 this.jsApiCall();
			 }
		 }
		},
		created () {
			this.getBaseData()
		},
		computed: {
			total_value: function () {
				return  (parseInt(this.money) > 0 ? parseInt(this.money):0)  + (this.state ? 3 : 0)
			}
		}
	}).$mount('#app');
</script>
</body>
</html>